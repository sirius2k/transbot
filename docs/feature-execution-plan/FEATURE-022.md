# FEATURE-022: Langfuse V3 ì—…ê·¸ë ˆì´ë“œ

## ê°œìš”

- **ê¸°ëŠ¥ëª…**: Langfuse V3 ì—…ê·¸ë ˆì´ë“œ
- **ìƒíƒœ**: ðŸ”² ì˜ˆì •
- **ë¶„ë¥˜**: ì¸í”„ë¼
- **ìš°ì„ ìˆœìœ„**: P1 (ë†’ìŒ)
- **ë³µìž¡ë„**: Simple (1-3h)
- **ë¶„ì„ ìˆ˜ì¤€**: ì—†ìŒ
- **ì§„í–‰ë¥ **: 0%
- **ì˜ˆìƒ ì‹œê°„**: 1-2ì‹œê°„
- **ì‹¤ì œ ì†Œìš”**: - (ì™„ë£Œ í›„ ê¸°ë¡)
- **ì‹œìž‘ì¼**: -
- **ì™„ë£Œì¼**: -

## ê¸°ëŠ¥ ì„¤ëª…

Langfuseë¥¼ V2ì—ì„œ V3ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì—¬ ìµœì‹  ê¸°ëŠ¥ì„ ì ìš©í•˜ê³  ê¸°ìˆ  ë¶€ì±„ë¥¼ í•´ì†Œí•©ë‹ˆë‹¤.

### ëª©í‘œ

- Langfuse V2 â†’ V3 ì—…ê·¸ë ˆì´ë“œ
- ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
- ì„±ëŠ¥ ê°œì„  ë° ìƒˆë¡œìš´ ê¸°ëŠ¥ í™œìš©
- ìš´ì˜ ì•ˆì •ì„± í™•ë³´

### ë°°ê²½

- í˜„ìž¬ Langfuse V2 ì‚¬ìš© ì¤‘ (`requirements.txt`: `langfuse>=2.0.0,<3.0.0`)
- V3ëŠ” ClickHouse ê¸°ë°˜ ë¶„ì„ ê¸°ëŠ¥ ì¶”ê°€ (ì„ íƒì )
- docker-compose.ymlì— ClickHouse ì„¤ì •ì´ ì´ë¯¸ ì¤€ë¹„ë˜ì–´ ìžˆìŒ (ì£¼ì„ ì²˜ë¦¬)

## ìž‘ì—…(Task) ë¶„í•´

### Task 1: Langfuse V3 ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ ì¡°ì‚¬

**ë¶„ë¥˜**: ì¡°ì‚¬

**ìž‘ì—… ë‚´ìš©**:

1. Langfuse V2 â†’ V3 ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ í™•ì¸
2. ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ ëª©ë¡ ì •ë¦¬
3. Python SDK API ë³€ê²½ì‚¬í•­ í™•ì¸
4. í™˜ê²½ ë³€ìˆ˜ ë³€ê²½ì‚¬í•­ í™•ì¸

**ì˜ˆìƒ íŒŒì¼**:

- ì—†ìŒ (ì›¹ ê²€ìƒ‰ ë˜ëŠ” ê³µì‹ ë¬¸ì„œ í™•ì¸)

**ì˜ì¡´ì„±**: ì—†ìŒ

### Task 2: Python íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸

**ë¶„ë¥˜**: ì¸í”„ë¼

**ìž‘ì—… ë‚´ìš©**:

1. `requirements.txt` ìˆ˜ì •: `langfuse>=2.0.0,<3.0.0` â†’ `langfuse>=3.0.0,<4.0.0`
2. ê°€ìƒí™˜ê²½ì—ì„œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸: `pip install -r requirements.txt`
3. ì˜ì¡´ì„± ì¶©ëŒ í™•ì¸ ë° í•´ê²°

**ì˜ˆìƒ íŒŒì¼**:

- `requirements.txt`

**ì˜ì¡´ì„±**: Task 1

### Task 3: Docker ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸

**ë¶„ë¥˜**: ì¸í”„ë¼

**ìž‘ì—… ë‚´ìš©**:

1. `infra/docker-compose.yml` ìˆ˜ì •
   - Langfuse ì´ë¯¸ì§€: `langfuse/langfuse:2` â†’ `langfuse/langfuse:3`
   - ClickHouse ì„œë¹„ìŠ¤ í™œì„±í™” ì—¬ë¶€ ê²°ì • (ì„ íƒì )
2. `.env.infra.example` ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)
3. Docker ì»¨í…Œì´ë„ˆ ìž¬ì‹œìž‘: `infra/scripts/stop.sh && infra/scripts/start.sh`

**ì˜ˆìƒ íŒŒì¼**:

- `infra/docker-compose.yml`
- `infra/.env.infra.example` (í•„ìš” ì‹œ)

**ì˜ì¡´ì„±**: Task 1

### Task 4: ì½”ë“œ ìˆ˜ì • (ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ ëŒ€ì‘)

**ë¶„ë¥˜**: ì½”ë“œ

**ìž‘ì—… ë‚´ìš©**:

1. `components/observability.py` ìˆ˜ì • (í•„ìš” ì‹œ)
   - API ë³€ê²½ì‚¬í•­ ë°˜ì˜
   - ë°ì½”ë ˆì´í„° ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ë²• ì—…ë°ì´íŠ¸
2. `app.py` ìˆ˜ì • (í•„ìš” ì‹œ)
3. ì—ëŸ¬ í•¸ë“¤ë§ ì½”ë“œ í™•ì¸

**ì˜ˆìƒ íŒŒì¼**:

- `components/observability.py`
- `app.py` (í•„ìš” ì‹œ)

**ì˜ì¡´ì„±**: Task 1, Task 2

### Task 5: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦

**ë¶„ë¥˜**: í…ŒìŠ¤íŠ¸

**ìž‘ì—… ë‚´ìš©**:

1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰: `pytest`
2. Langfuse ëŒ€ì‹œë³´ë“œ ì ‘ì† í™•ì¸: `http://localhost:3000`
3. ë²ˆì—­ ìˆ˜í–‰ í›„ Langfuseì— ì¶”ì  ë°ì´í„° í‘œì‹œ í™•ì¸
4. ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸ (API í‚¤ ì˜¤ë¥˜, ì„œë²„ ë‹¤ìš´ ë“±)
5. ì„±ëŠ¥ ë° ì•ˆì •ì„± í™•ì¸

**ì˜ˆìƒ íŒŒì¼**:

- ì—†ìŒ (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)

**ì˜ì¡´ì„±**: Task 2, Task 3, Task 4

### Task 6: ë¬¸ì„œ ì—…ë°ì´íŠ¸

**ë¶„ë¥˜**: ë¬¸ì„œ

**ìž‘ì—… ë‚´ìš©**:

1. `docs/guides/infrastructure/langfuse/setup.md` ì—…ë°ì´íŠ¸
   - "Langfuse v2" â†’ "Langfuse v3"ë¡œ ë³€ê²½
   - V3 íŠ¹í™” ì„¤ì • ì¶”ê°€ (ClickHouse ë“±)
2. `CLAUDE.md` ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)
3. `README.md` ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)
4. Troubleshooting ê°€ì´ë“œ ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)

**ì˜ˆìƒ íŒŒì¼**:

- `docs/guides/infrastructure/langfuse/setup.md`
- `CLAUDE.md` (í•„ìš” ì‹œ)
- `README.md` (í•„ìš” ì‹œ)

**ì˜ì¡´ì„±**: Task 5

## ì™„ë£Œ ê¸°ì¤€

- [ ] Langfuse V3 ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ ì¡°ì‚¬ ì™„ë£Œ
- [ ] `requirements.txt`ì— `langfuse>=3.0.0,<4.0.0` ì ìš©
- [ ] `docker-compose.yml`ì— Langfuse V3 ì´ë¯¸ì§€ ì ìš©
- [ ] ì½”ë“œ ìˆ˜ì • ì™„ë£Œ (ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ ëŒ€ì‘)
- [ ] ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] Langfuse ëŒ€ì‹œë³´ë“œ ì •ìƒ ìž‘ë™ í™•ì¸
- [ ] ë²ˆì—­ ìˆ˜í–‰ í›„ Langfuseì— ì¶”ì  ë°ì´í„° ì •ìƒ í‘œì‹œ
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ
- [ ] ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ

## ì°¸ê³  ì‚¬í•­

### ClickHouse ì‚¬ìš© ì—¬ë¶€

Langfuse V3ëŠ” ClickHouseë¥¼ ë¶„ì„ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤ (ì„ íƒì ).

**ClickHouseë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**:

- ëŒ€ëŸ‰ì˜ íŠ¸ë ˆì´ìŠ¤ ë°ì´í„° ë¶„ì„ì— ìœ ë¦¬
- `docker-compose.yml`ì˜ ClickHouse ì„œë¹„ìŠ¤ ì£¼ì„ í•´ì œ
- í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ ì„¤ì • í•„ìš”

**ClickHouseë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°**:

- PostgreSQLë§Œìœ¼ë¡œ ì¶©ë¶„ (ì†Œê·œëª¨ í”„ë¡œì íŠ¸)
- ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”
- ê¸°ì¡´ ì„¤ì • ê·¸ëŒ€ë¡œ ì‚¬ìš©

**ê¶Œìž¥**: TransBotì€ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ì´ë¯€ë¡œ **ClickHouse ì—†ì´ PostgreSQLë§Œ ì‚¬ìš©**í•˜ëŠ” ê²ƒì„ ê¶Œìž¥í•©ë‹ˆë‹¤.

### ë¡¤ë°± ê³„íš

ì—…ê·¸ë ˆì´ë“œ ì¤‘ ë¬¸ì œ ë°œìƒ ì‹œ:

1. `requirements.txt`: `langfuse>=2.0.0,<3.0.0`ë¡œ ë³µì›
2. `docker-compose.yml`: `langfuse/langfuse:2`ë¡œ ë³µì›
3. Docker ìž¬ì‹œìž‘: `infra/scripts/stop.sh && infra/scripts/start.sh`
4. ê°€ìƒí™˜ê²½ íŒ¨í‚¤ì§€ ìž¬ì„¤ì¹˜: `pip install -r requirements.txt`

---

**ìž‘ì„±ì¼**: 2026-02-05
**ìž‘ì„±ìž**: Claude Sonnet 4.5